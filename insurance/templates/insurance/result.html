{% extends 'base.html' %}
{% block title %}Prediction Result - Healthcare Management System{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Success Message -->
            <div class="text-center mb-4">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h2>Your Insurance Cost Estimate</h2>
                <p class="text-muted">Based on the information provided</p>
            </div>
            
            <!-- Main Result Card -->
            <div class="card shadow-lg mb-4">
                <div class="card-header bg-success text-white text-center">
                    <h3 class="mb-0">Estimated Annual Cost</h3>
                </div>
                <div class="card-body text-center py-5">
                    <h1 class="display-2 text-success mb-3">
                        ${{ prediction.predicted_cost|floatformat:2 }}
                    </h1>
                    <p class="text-muted">per year</p>
                    {% widthratio prediction.predicted_cost 12 1 as monthly_cost %}
                    <p class="lead">Approximately <strong>${{ monthly_cost|floatformat:2 }}</strong> per month</p>
                </div>
            </div>
            
            <div class="row">
                <!-- Input Details -->
                <div class="col-md-6">
                    <div class="card shadow mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-user"></i> Your Information</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <tr>
                                    <th>Age:</th>
                                    <td>{{ prediction.age }} years</td>
                                </tr>
                                <tr>
                                    <th>Sex:</th>
                                    <td>{{ prediction.sex|title }}</td>
                                </tr>
                                <tr>
                                    <th>BMI:</th>
                                    <td>{{ prediction.bmi }}</td>
                                </tr>
                                <tr>
                                    <th>Children:</th>
                                    <td>{{ prediction.children }}</td>
                                </tr>
                                <tr>
                                    <th>Smoker:</th>
                                    <td>
                                        {% if prediction.smoker == 'yes' %}
                                            <span class="badge bg-danger">Yes</span>
                                        {% else %}
                                            <span class="badge bg-success">No</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Region:</th>
                                    <td>{{ prediction.get_region_display }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Risk Factors -->
                <div class="col-md-6">
                    <div class="card shadow mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Risk Factors</h5>
                        </div>
                        <div class="card-body">
                            {% if risk_factors %}
                                {% for factor in risk_factors %}
                                    <div class="mb-3 p-3 border-start border-4 
                                        {% if factor.impact == 'Very High' %}border-danger bg-light
                                        {% elif factor.impact == 'High' %}border-warning bg-light
                                        {% else %}border-info bg-light{% endif %}">
                                        <h6 class="mb-1">{{ factor.factor }}
                                            <span class="badge 
                                                {% if factor.impact == 'Very High' %}bg-danger
                                                {% elif factor.impact == 'High' %}bg-warning
                                                {% else %}bg-info{% endif %}">
                                                {{ factor.impact }}
                                            </span>
                                        </h6>
                                        <small class="text-muted">{{ factor.recommendation }}</small>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="alert alert-success">
                                    <i class="fas fa-thumbs-up"></i> Great! No major risk factors detected.
                                    Keep maintaining your healthy lifestyle!
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Feature Importance -->
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Factors Affecting Your Cost</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">These factors have the most impact on insurance costs:</p>
                    {% for feature, importance in feature_importance.items %}
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>{{ feature }}</span>
                                <span class="text-muted">Impact Score: {{ importance|floatformat:0 }}</span>
                            </div>
                            {% widthratio importance 250 1 as progress_width %}
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar bg-info" role="progressbar" 
                                     style="width: {% if progress_width > 100 %}100{% else %}{{ progress_width }}{% endif %}%">
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Actions -->
            <div class="text-center mb-4">
                <a href="{% url 'insurance:predict' %}" class="btn btn-primary me-2">
                    <i class="fas fa-redo"></i> Make Another Prediction
                </a>
                <a href="{% url 'insurance:history' %}" class="btn btn-secondary me-2">
                    <i class="fas fa-history"></i> View History
                </a>
                <a href="{% url 'users:dashboard' %}" class="btn btn-outline-primary">
                    <i class="fas fa-home"></i> Back to Dashboard
                </a>
            </div>
            
            <!-- Disclaimer -->
            <div class="alert alert-warning">
                <i class="fas fa-info-circle"></i> <strong>Disclaimer:</strong> This is an estimate based on statistical modeling and should not be considered as an actual insurance quote. Please contact insurance providers for accurate quotes.
            </div>
        </div>
    </div>
</div>
{% endblock %}